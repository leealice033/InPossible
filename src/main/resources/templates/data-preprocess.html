<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>InAnalysis</title>
<link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="/webjars/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link href="/webjars/seiyria-bootstrap-slider/dist/css/bootstrap-slider.css" rel="stylesheet" />
<style>
.slider {
	width: 100% !important;
}
</style>
</head>
<body>

  <div th:replace="fragments/header :: header"></div>

  <div class="container-fluid">
    <div class="row">
      <!-- projectType=csvInfo.projectType -->
      <!-- SideBar -->
      <div class="col-md-2"
        th:if="${csvInfo.projectType.equals('abnormal-detection')||csvInfo.projectType.equals('regression')||csvInfo.projectType.equals('classification')}">
        <div th:replace="fragments/sidebar :: sidebar"></div>
      </div>

      <div class="col-md-2" th:if="${csvInfo.projectType.equals('clustering')}">
        <div th:replace="fragments/sidebar-noprediction :: sidebar"></div>
      </div>
      <!-- /SideBar -->

      <div class="col-md-10">
        <h3>
          Data Pre-processing
          <span class="badge" th:text="${csvInfo.server}">Server</span>
        </h3>

        <div class="well well-sm">
          File Name:
          <span class="label label-primary" th:text="${csvInfo.fileName}"></span>
        </div>
        <!-- action="www.spufalcons.com/index.aspx?tab=gymnastics&path=gym" -->
        <form method="POST" action="/data-preprocess">
          <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->
          <input type="hidden" name="projectId" th:value="${csvInfo.projectId}"></input>
          <input type="hidden" name="fileId" th:value="${csvInfo.fileId}"></input>

          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Step 1 : Select Feature to Show Raw Data</h3>
            </div>
            <div class="panel-body">

              <div class="form-inline">
                <label for="featureSelect" data-toggle="tooltip" data-placement="top"
                  title="Choose one feature for preview">
                  Feature
                  <i class="fa fa-info-circle text-info" aria-hidden="true"></i>
                </label>
                <select id="columnNameSelect" class="form-control" name="featureName"
                  th:field="*{previewParam.featureName}">
                  <option th:each="columnName : ${csvInfo.columnNames}" th:value="${columnName}" th:text="${columnName}">ColumnName</option>
                </select>
                <!-- 
 -->
                <script th:if="${action != null}">
																	document
																			.getElementById("columnNameSelect").disabled = true;
																</script>
              </div>


              <div th:if="${action == null}" class="form-inline">
                <br>
                <input type="submit" class="btn btn-warning" name="action" value="Cancel"></input>
                <input type="submit" class="showLoadingIcon btn btn-primary" name="action" value="Select Feature"></input>
              </div>
              <!-- 
 -->
              <div th:if="${featureImgPath}" class="row">
                <img class="img-responsive" th:src="${featureImgPath}" />
              </div>

            </div>
          </div>

          <div th:if="${action != null && (action.equals('SelectFeature') || action.equals('Preview'))}"
            class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Step 2 : Filter Out Noise Data</h3>
            </div>
            <div class="panel-body">

              <div class="form-inline">
                <label for="filterMissingValueCheckbox" data-toggle="tooltip" data-placement="top"
                  title="Delete the row with NaN">
                  Filter Missing Value
                  <i class="fa fa-info-circle text-info" aria-hidden="true"></i>
                </label>
                <input type="checkbox" id="filterMissingValueCheckbox" name="filterMissingValue"
                  th:checked="${previewParam.filterMissingValue}" />
              </div>

              <div class="form-inline">
                <label for="filterOutlier" data-toggle="tooltip" data-placement="top"
                  title="Remove the outlier points by eliminating any points that were above (Mean + 2*std) and any points below (Mean - 2*std)">
                  Standard Deviation Outliers Filter
                  <i class="fa fa-info-circle text-info" aria-hidden="true"></i>
                </label>
                <select class="form-control" name="filterOutlier" th:field="*{previewParam.filterOutlier}">
                  <option value="0">None</option>
                  <option value="1">1 std</option>
                  <option value="2">2 std</option>
                  <option value="3">3 std</option>
                </select>
              </div>



              <div class="form-inline">
                <a class="btn btn-warning"
                  th:href="${(#mvc.url('DPPC#toDataPreprocessPage').arg(0,csvInfo.projectId).arg(1,csvInfo.fileId)).build()}">
                  Back To Step 1</a>
                <input type="submit" class="showLoadingIcon btn btn-primary" name="action" value="Preview"></input>
              </div>

              <div class="row">
                <div th:if="${previewImgPath}">
                  <img class="img-responsive" th:src="${previewImgPath}" />
                </div>
              </div>



            </div>
          </div>

          <div th:if="${action != null && action.equals('Preview')}" class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Step 3 : Select Feature to Normalize (Optional)</h3>
            </div>
            <div class="panel-body">

              <div class="form-group">
                <label for="featureSelect">Normalize Algorithm</label>
                <select class="form-control" name="normalizeAlgorithm">
                  <option value="MinMaxScaler">Min Max Scaler</option>
                </select>
              </div>

              <label>Normalize Feature</label>

              <div class="form-inline">
                <label th:each="columnName : ${csvInfo.columnNames}" class="checkbox-inline">
                  <input th:if="${columnName!=csvInfo.label}" type="checkbox" name="normalizeFeatureName"
                    th:value="${columnName}" />
                  <strong th:if="${columnName.equals(csvInfo.label)}" style="color: red" data-toggle="tooltip"
                    title="Label can't be normalized">label:</strong>
                  <span th:text="${columnName}"></span>
                </label>
              </div>

            </div>
          </div>

          <div th:if="${action != null && action.equals('Preview')}" class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Save Pre-processed Data</h3>
            </div>

            <div class="panel-body">
              <div class="form-group">
                <label for="mergeMethodList">Data Pre-processed File Name</label>
                <input type="text" class="form-control" name="newFileName" placeholder="pre-processed file name" />

              </div>

              <div class="form-inline">
                <input type="submit" class="btn btn-warning" name="action" value="Cancel"></input>
                <input th:if="${action != null && action.equals('Preview')}" type="submit"
                  class="showLoadingIcon btn btn-primary" name="action" value="Save"></input>
              </div>
            </div>
          </div>

        </form>

      </div>
    </div>
  </div>
  <!-- end container -->

  <script src="/webjars/jquery/jquery.min.js"></script>
  <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
  <div th:replace="fragments/sidebar :: sidebar-js"></div>

  <script>
			$(".btn").click(function() {
				document.getElementById("columnNameSelect").disabled = false;
			});
		</script>

  <!-- slider -->
  <script src="/webjars/seiyria-bootstrap-slider/dist/bootstrap-slider.js"></script>
  <script th:inline="javascript">
			var intervalNumber = /*[[${intervalNumber}]]*/'100';
			console.log("intervalNumber: " + intervalNumber);
			$("#intervalNumber").slider({
				step : 1,
				min : 10,
				max : 1000,
				value : intervalNumber
			});
		</script>

  <!-- Canvas -->
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  <script th:inline="javascript">
			/*<![CDATA[*/
			var dataRawChartString = /*[[${dataRawChartString}]]*/null;
			console.log("dataRawChartString: " + dataRawChartString);

			if (dataRawChartString != null) {
				var array = dataRawChartString.split(";");
				var myList = new Array();
				for (i = 0; i < array.length; i++) {
					var splitArray = array[i].split(",");
					var x = parseFloat(splitArray[0]);
					var y = parseFloat(splitArray[1]);
					var point = {
						"x" : x,
						"y" : y
					};
					myList.push(point);
				}

				var title = /*[[${csvInfo.fileName}]]*/null;
				title = "Raw Data: " + title;

				var dataRawChart = new CanvasJS.Chart("dataRawChart", {
					"title" : {
						"text" : title
					},
					"axisY" : {
						"title" : "Count"
					},
					"data" : [ {
						"color" : "#0F52BA",
						"type" : "column",
						"dataPoints" : myList
					} ]
				});
				dataRawChart.render();
				dataRawChart = {};
			} else {
				$("#dataRawChart").hide()
			}
			/*]]>*/
		</script>

  <script th:inline="javascript">
			/*<![CDATA[*/
			var dataString = /*[[${dataString}]]*/null;
			console.log("dataString: " + dataString);

			if (dataString != null) {
				var array = dataString.split(";");
				var myList = new Array();
				for (i = 0; i < array.length; i++) {
					var splitArray = array[i].split(",");
					var x = parseFloat(splitArray[0]);
					var y = parseFloat(splitArray[1]);
					var point = {
						"x" : x,
						"y" : y
					};
					myList.push(point);
				}

				var title = /*[[${csvInfo.fileName}]]*/null;
				title = "Pre-processed Data: " + title;

				var chart = new CanvasJS.Chart("dataPreProcessChart", {
					"title" : {
						"text" : title
					},
					"axisY" : {
						"title" : "Count"
					},
					"data" : [ {
						"color" : "#0F52BA",
						"type" : "column",
						"dataPoints" : myList
					} ]
				});
				chart.render();
				chart = {};
			} else {
				$("#dataPreProcessChart").hide()
			}
			/*]]>*/
		</script>

  <script>
			$(document).ready(function() {
				$('[data-toggle="tooltip"]').tooltip();
			});
		</script>
</body>
</html>
